---
tags:
  - Flask
---
Вот подробная инструкция по настройке Docker для Flask-backend приложений. Мы пройдем через все этапы: от создания необходимых файлов до запуска приложения в контейнере.

---

## Шаг 1: Создание Dockerfile

Для начала нужно создать файл `Dockerfile`, который описывает, как собрать Docker-образ для вашего Flask-приложения. Создайте файл с именем `Dockerfile` в корневой директории проекта и добавьте в него следующий код:

```dockerfile
# Используем официальный образ Python
FROM python:3.9-slim

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Копируем файл зависимостей в контейнер
COPY requirements.txt .

# Устанавливаем зависимости
RUN pip install --no-cache-dir -r requirements.txt

# Копируем все файлы приложения в контейнер
COPY . .

# Указываем команду для запуска приложения
CMD ["python", "app.py"]
```

### Объяснение:
- `FROM python:3.9-slim` — используем легковесный образ Python 3.9.
- `WORKDIR /app` — задаем рабочую директорию `/app` внутри контейнера.
- `COPY requirements.txt .` — копируем файл с зависимостями.
- `RUN pip install ...` — устанавливаем зависимости из `requirements.txt`.
- `COPY . .` — копируем все файлы проекта в контейнер.
- `CMD ["python", "app.py"]` — команда для запуска Flask-приложения (предполагается, что ваш основной файл называется `app.py`).

---

## Шаг 2: Создание файла зависимостей `requirements.txt`

Создайте файл `requirements.txt` в корневой директории проекта. В нем укажите все библиотеки, которые нужны вашему Flask-приложению. Пример:

```
Flask==2.0.1
gunicorn==20.1.0
```

- `Flask` — основная библиотека для вашего backend-приложения.
- `gunicorn` — WSGI-сервер для запуска Flask в продакшене (опционально).

Если у вас есть дополнительные зависимости (например, для работы с базой данных), добавьте их в этот файл.

---

## Шаг 3: Сборка Docker-образа

Откройте терминал в директории с `Dockerfile` и выполните следующую команду для сборки Docker-образа:

```bash
docker build -t my-flask-app .
```

### Объяснение:
- `-t my-flask-app` — задает имя (тег) для вашего образа, например, `my-flask-app`.
- `.` — указывает Docker использовать текущую директорию, где находится `Dockerfile`.

После выполнения команды Docker создаст образ на основе вашего `Dockerfile`.

---

## Шаг 4: Запуск контейнера

Теперь, когда образ собран, вы можете запустить контейнер с помощью команды:

```bash
docker run -p 5000:5000 my-flask-app
```

### Объяснение:
- `-p 5000:5000` — пробрасывает порт 5000 из контейнера на порт 5000 вашего хоста (Flask по умолчанию использует порт 5000).
- `my-flask-app` — имя образа, которое вы указали на этапе сборки.

После запуска вы сможете открыть браузер или использовать инструмент вроде `curl`, чтобы проверить работу приложения по адресу `http://localhost:5000`.

---

## Шаг 5: Использование `docker-compose` (опционально)

Если ваше приложение взаимодействует с другими сервисами (например, базой данных), удобно использовать `docker-compose`. Создайте файл `docker-compose.yml` в корневой директории проекта:

```yaml
version: '3'
services:
  web:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - .:/app
    depends_on:
      - db
  db:
    image: postgres:13
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: mydb
```

### Объяснение:
- `web` — сервис для вашего Flask-приложения:
  - `build: .` — собирает образ из текущего `Dockerfile`.
  - `ports` — пробрасывает порт 5000.
  - `volumes` — монтирует текущую директорию в `/app` для автоматического обновления кода.
  - `depends_on` — указывает, что сервис зависит от базы данных.
- `db` — сервис базы данных PostgreSQL:
  - `image: postgres:13` — использует официальный образ PostgreSQL.
  - `environment` — задает настройки базы данных (имя пользователя, пароль, имя базы).

---

## Шаг 6: Запуск с `docker-compose`

Для запуска всех сервисов выполните:

```bash
docker-compose up
```

Эта команда соберет образы и запустит контейнеры для всех сервисов, описанных в `docker-compose.yml`. Чтобы остановить, используйте `Ctrl+C`, а для полного завершения и удаления контейнеров — `docker-compose down`.

---

## Пример структуры проекта

После выполнения всех шагов ваша директория может выглядеть так:

```
my-flask-app/
├── app.py              # Основной файл Flask-приложения
├── requirements.txt    # Зависимости
├── Dockerfile          # Инструкции для сборки образа
└── docker-compose.yml  # (опционально) Конфигурация сервисов
```
